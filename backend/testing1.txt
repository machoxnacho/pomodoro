

docker buildx build \
  --platform linux/amd64 \
  -t 900546069136.dkr.ecr.us-east-1.amazonaws.com/smiski-backend:latest \
  --push .

# ---- Frontend build stage ----
FROM node:18-alpine AS frontend
WORKDIR /app

# Copy React app and dependencies
COPY ./src ./src
COPY package.json package-lock.json ./

# Install frontend dependencies (in root, not in src)
RUN npm install

# Build the React app (source in ./src, output to ./build)
RUN npm run build -- --output-path=build --watch=false

# ---- Backend build stage ----
FROM node:18-alpine AS backend
WORKDIR /app

# Copy backend files
COPY ./backend ./backend
COPY ./backend/package.json ./backend/package-lock.json ./backend/

# Copy built frontend into backend/public
COPY --from=frontend /app/build ./backend/public

# Install backend dependencies
WORKDIR /app/backend
RUN npm install

# ---- Final stage ----
FROM node:18-alpine
WORKDIR /app

# Copy everything from backend stage
COPY --from=backend /app/backend .

EXPOSE 5000
CMD ["node", "server.js"]

 => ERROR [frontend 6/6] RUN npm run build -- --output-path=build --watch=false                                           2.5s
------                                                                                                                         
 > [frontend 6/6] RUN npm run build -- --output-path=build --watch=false:                                                      
0.700                                                                                                                          
0.700 > work-faster@0.1.0 build
0.700 > react-scripts build --output-path=build --watch=false
0.700 
2.497 Could not find a required file.
2.498   Name: index.html
2.498   Searched in: /app/public
------
Dockerfile:13
--------------------
  11 |     
  12 |     # Build the React app (source in ./src, output to ./build)
  13 | >>> RUN npm run build -- --output-path=build --watch=false
  14 |     
  15 |     # ---- Backend build stage ----
--------------------
ERROR: failed to build: failed to solve: process "/bin/sh -c npm run build -- --output-path=build --watch=false" did not complete successfully: exit code: 1

View build details: docker-desktop://dashboard/build/relaxed_diffie/relaxed_diffie0/kh8j3p359w60o3ms2yw69fvo8
